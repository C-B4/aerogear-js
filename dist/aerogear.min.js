/*! AeroGear JavaScript Library - v1.0.0.Alpha - 2012-09-20
* https://github.com/aerogear/aerogear-js
* JBoss, Home of Professional Open Source
* Copyright 2012, Red Hat, Inc., and individual contributors
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
* http://www.apache.org/licenses/LICENSE-2.0
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/
(function(e,t){var n=e.aerogear={add:function(e){var t,r,i=this._getCollection();if(!e)return this;if(typeof e=="string")i[e]=n[this.lib].adapters[this.defaultAdapter](e,"id");else if(n.isArray(e))for(t=0;t<e.length;t++)r=e[t],typeof r=="string"?i[r]=n[this.lib].adapters[this.defaultAdapter](r):i[r.name]=n[this.lib].adapters[r.type||this.defaultAdapter](r.name,r.settings||{});else i[e.name]=n[this.lib].adapters[e.type||this.defaultAdapter](e.name,e.settings||{});return this._setCollection(i),this},remove:function(e){var t,r,i=this._getCollection();if(typeof e=="string")delete i[e];else if(n.isArray(e))for(t=0;t<e.length;t++)r=e[t],typeof r=="string"?delete i[r]:delete i[r.name];else e&&delete i[e.name];return this._setCollection(i),this}};n.isArray=function(e){return{}.toString.call(e)==="[object Array]"}})(this),function(e,t){e.pipeline=function(t){var n={lib:"pipeline",defaultAdapter:"rest",pipes:{},add:function(t,n){return e.add.call(this,t)},remove:function(t){return e.remove.call(this,t)},_setCollection:function(e){this.pipes=e},_getCollection:function(){return this.pipes}};return n.add(t)},e.pipeline.adapters={}}(aerogear),function(e,t,n){e.pipeline.adapters.rest=function(n,r){var i=r&&r.endPoint?r.endPoint:n,s=t.extend({url:r&&r.baseURL?r.baseURL+"/"+i:i,contentType:"application/json",dataType:"json"},r);return{recordId:r&&r.recordId?r.recordId:"id",type:"rest",read:function(n){var r;n?(n.ajax&&n.ajax.data?r=n.ajax.data:n.data?r=n.data:n.ajax||(n.ajax={}),r&&(n.ajax.data=r)):n={ajax:{}};var i=function(t){var r=n.valves?e.isArray(n.valves)?n.valves:[n.valves]:[],i;if(r.length)for(i in r)r[i].save(t,!0);n.ajax.success&&n.ajax.success.apply(this,arguments)};return t.ajax(t.extend({},s,{type:"GET"},n.ajax,{success:i}))},save:function(n,r){var i,o;n=n||{},r=r||{},i=n[this.recordId]?"PUT":"POST",!r.ajax.url&&n[this.recordId]?o=s.url+"/"+n[this.recordId]:r.ajax.url?o=r.ajax.url:o=s.url;var u=function(t){var n=e.isArray(r.valves)?r.valves:[r.valves],i;if(r.valves)for(i in n)n[i].save(t);r.ajax.success&&r.ajax.success.apply(this,arguments)};return typeof n!="string"&&(n=JSON.stringify(n)),t.ajax(t.extend({},s,{data:n,type:i,url:o},r.ajax||{},{success:u}))},remove:function(n,r){var i="",o,u;r=r||{};if(typeof n=="string"||typeof n=="number")o=parseInt(n,10);else{if(!n)throw"aerogear.pipeline.rest: missing argument";typeof n.record=="string"||typeof n.record=="number"?o=parseInt(n.record,10):n.record&&(o=parseInt(n.record[this.recordId],10))}i=o?"/"+o:"",r.ajax?r.ajax.url?u=r.ajax.url:u=s.url+i:n.ajax?(r.ajax=n.ajax,n.ajax.url?u=n.ajax.url:u=s.url+i):u=s.url+i;var a=function(t){var n=e.isArray(r.valves)?r.valves:[r.valves],i;if(r.valves)for(i in n)n[i].remove(o);r.ajax.success&&r.ajax.success.apply(this,arguments)};return t.ajax(t.extend({},s,{type:"DELETE",url:u},r.ajax||{},{success:a}))}}}}(aerogear,jQuery),function(e,t){e.dataManager=function(t){var n={lib:"dataManager",defaultAdapter:"memory",valves:{},add:function(t){return e.add.call(this,t)},remove:function(t){return e.remove.call(this,t)},_setCollection:function(e){this.valves=e},_getCollection:function(){return this.valves}};return n.add(t)},e.dataManager.adapters={}}(aerogear),function(e,t,n){e.dataManager.adapters.memory=function(t,n){return{recordId:n&&n.recordId?n.recordId:"id",type:"memory",data:null,read:function(e){var t={};return t[this.recordId]=e,e?this.filter(t):this.data},save:function(t,n){var r=!1;t=e.isArray(t)?t:[t];if(n)this.data=t;else if(this.data)for(var i=0;i<t.length;i++){for(var s in this.data)if(this.data[s].id===t[i].id){this.data[s]=t[i],r=!0;break}r||this.data.push(t[i]),r=!1}else this.data=t;return this.data},remove:function(t){if(!t)return this.data=[];t=e.isArray(t)?t:[t];var n,r;for(var i=0;i<t.length;i++){if(typeof t[i]=="string"||typeof t[i]=="number")n=t[i];else{if(!t)continue;n=t[i][this.recordId]}for(r in this.data)this.data[r].id===n&&this.data.splice(r,1)}return this.data},filter:function(e,t){var n,r,i;return e?(n=this.data.filter(function(n,s,o){var u=t?!1:!0,a=Object.keys(e),f,l,c;for(r=0;r<a.length;r++){if(e[a[r]].data){f=e[a[r]],c=f.matchAny?!1:!0;for(i=0;i<f.data.length;i++){if(f.matchAny&&f.data[i]===n[a[r]]){c=!0;break}if(!f.matchAny&&f.data[i]!==n[a[r]]){c=!1;break}}}else c=e[a[r]]===n[a[r]]?!0:!1;if(t&&c){u=!0;break}if(!t&&!c){u=!1;break}}return u}),n):(n=this.data||[],n)}}}}(aerogear,jQuery);