/*! AeroGear JavaScript Library - v1.0.0.Alpha - 2012-10-02
* https://github.com/aerogear/aerogear-js
* JBoss, Home of Professional Open Source
* Copyright 2012, Red Hat, Inc., and individual contributors
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
* http://www.apache.org/licenses/LICENSE-2.0
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/
(function(e,t){var n=e.aerogear={add:function(e){var t,r,i=this[this.collectionName]||{};if(!e)return this;if(typeof e=="string")i[e]=n[this.lib].adapters[this.type](e);else if(n.isArray(e))for(t=0;t<e.length;t++)r=e[t],typeof r=="string"?i[r]=n[this.lib].adapters[this.type](r):i[r.name]=n[this.lib].adapters[r.type||this.type](r.name,r.settings||{});else i[e.name]=n[this.lib].adapters[e.type||this.type](e.name,e.settings||{});return this[this.collectionName]=i,this},remove:function(e){var t,r,i=this[this.collectionName]||{};if(typeof e=="string")delete i[e];else if(n.isArray(e))for(t=0;t<e.length;t++)r=e[t],typeof r=="string"?delete i[r]:delete i[r.name];else e&&delete i[e.name];return this[this.collectionName]=i,this}};n.isArray=function(e){return{}.toString.call(e)==="[object Array]"}})(this),function(e,t,n){e.ajax=function(n,r){var i=t.Deferred(function(){var i=this,s=t.extend({},{contentType:"application/json",dataType:"json"},r);this.done(s.success),this.fail(s.error),this.always(s.complete);var o=t.extend({},s,{success:function(e,t,n){i.resolve(typeof e=="string"&&o.dataType==="json"?JSON.parse(e):e,t,n)},error:function(e,t,n){if(o.dataType==="json")try{e.responseJSON=JSON.parse(e.responseText)}catch(r){}i.reject(e,t,n)},complete:function(e,t){i.resolve(e,t)}});o.contentType==="application/json"&&o.data&&(o.type==="POST"||o.type==="PUT")&&(o.data=JSON.stringify(o.data)),e.auth&&!n.isAuthenticated()?this.reject("auth","Error: Authentication Required"):n.addAuth?t.ajax(n.addAuth(o)):t.ajax(o)}),s=i.promise();return s.success=i.done,s.error=i.fail,s.complete=i.always,s}}(aerogear,jQuery),function(e,t,n){e.pipeline=function(n){var r=t.extend({},e,{lib:"pipeline",type:n?n.type||"rest":"rest",collectionName:"pipes"});return r.add(n)},e.pipeline.adapters={}}(aerogear,jQuery),function(e,t,n){e.pipeline.adapters.rest=function(n,r){var i=r&&r.endPoint?r.endPoint:n,s={url:r&&r.baseURL?r.baseURL+i:i};return{recordId:r&&r.recordId?r.recordId:"id",authenticator:r&&r.authenticator?r.authenticator:null,type:"rest",read:function(n){n=n||{};var r=function(t){var r=n.stores?e.isArray(n.stores)?n.stores:[n.stores]:[],i;if(r.length)for(i in r)r[i].save(t,!0);n.success&&n.success.apply(this,arguments)},i=function(t,r){var i=n.stores?e.isArray(n.stores)?n.stores:[n.stores]:[],s;if(t==="auth"&&i.length)for(s in i)i[s].remove();n.error&&n.error.apply(this,arguments)},o={type:"GET",success:r,error:i,statusCode:n.statusCode,complete:n.complete};return e.ajax(this,t.extend({},s,o))},save:function(n,r){var i,o;n=n||{},r=r||{},i=n[this.recordId]?"PUT":"POST",n[this.recordId]?o=s.url+"/"+n[this.recordId]:o=s.url;var u=function(t){var n=e.isArray(r.stores)?r.stores:[r.stores],i;if(r.stores)for(i in n)n[i].save(t);r.success&&r.success.apply(this,arguments)},a=function(t,n){var i=r.stores?e.isArray(r.stores)?r.stores:[r.stores]:[],s;if(t==="auth"&&i.length)for(s in i)i[s].remove();r.error&&r.error.apply(this,arguments)},f={data:n,type:i,url:o,success:u,error:a,statusCode:r.statusCode,complete:r.complete};return e.ajax(this,t.extend({},s,f))},remove:function(n,r){var i="",o,u;typeof n=="string"||typeof n=="number"?o=n:n&&n[this.recordId]?o=n[this.recordId]:n&&!r&&(r=n),r=r||{},i=o?"/"+o:"",u=s.url+i;var a=function(t){var n,i;if(r.stores){n=e.isArray(r.stores)?r.stores:[r.stores];for(i in n)n[i].remove(o)}r.success&&r.success.apply(this,arguments)},f=function(t,n){var i=r.stores?e.isArray(r.stores)?r.stores:[r.stores]:[],s;if(t==="auth"&&i.length)for(s in i)i[s].remove();r.error&&r.error.apply(this,arguments)},l={type:"DELETE",url:u,success:a,error:f,statusCode:r.statusCode,complete:r.complete};return e.ajax(this,t.extend({},s,l))},isAuthenticated:function(){return this.authenticator?this.authenticator.isAuthenticated():!0},addAuth:function(e){return this.authenticator?this.authenticator.addAuth(e):e},deauthorize:function(){this.authenticator&&this.authenticator.deauthorize()}}}}(aerogear,jQuery),function(e,t,n){e.dataManager=function(n){var r=t.extend({},e,{lib:"dataManager",type:n?n.type||"memory":"memory",collectionName:"stores"});return r.add(n)},e.dataManager.adapters={}}(aerogear,jQuery),function(e,t,n){e.dataManager.adapters.memory=function(t,n){return{recordId:n&&n.recordId?n.recordId:"id",type:"memory",data:null,read:function(e){var t={};return t[this.recordId]=e,e?this.filter(t):this.data},save:function(t,n){var r=!1;t=e.isArray(t)?t:[t];if(n)this.data=t;else if(this.data)for(var i=0;i<t.length;i++){for(var s in this.data)if(this.data[s][this.recordId]===t[i][this.recordId]){this.data[s]=t[i],r=!0;break}r||this.data.push(t[i]),r=!1}else this.data=t;return this.data},remove:function(t){if(!t)return this.data=[];t=e.isArray(t)?t:[t];var n,r;for(var i=0;i<t.length;i++){if(typeof t[i]=="string"||typeof t[i]=="number")n=t[i];else{if(!t)continue;n=t[i][this.recordId]}for(r in this.data)this.data[r][this.recordId]===n&&this.data.splice(r,1)}return this.data},filter:function(e,t){var n,r,i;return e?(n=this.data.filter(function(n,s,o){var u=t?!1:!0,a=Object.keys(e),f,l,c;for(r=0;r<a.length;r++){if(e[a[r]].data){f=e[a[r]],c=f.matchAny?!1:!0;for(i=0;i<f.data.length;i++){if(f.matchAny&&f.data[i]===n[a[r]]){c=!0;break}if(!f.matchAny&&f.data[i]!==n[a[r]]){c=!1;break}}}else c=e[a[r]]===n[a[r]]?!0:!1;if(t&&c){u=!0;break}if(!t&&!c){u=!1;break}}return u}),n):(n=this.data||[],n)}}}}(aerogear,jQuery),function(e,t,n){e.auth=function(n){var r=t.extend({},e,{lib:"auth",type:n.type||"rest",collectionName:"modules"});return r.add(n)},e.auth.adapters={}}(aerogear,jQuery),function(e,t,n){e.auth.adapters.rest=function(e,n){var r=n&&n.endPoints||{};return n=n||{},{type:"rest",name:e,agAuth:!!n.agAuth,baseURL:n.baseURL,tokenName:n.tokenName||"Auth-Token",register:function(e,i){i=i||{};var s=this,o=function(e,t,n){sessionStorage.setItem("ag-auth-"+s.name,s.agAuth?n.getResponseHeader(s.tokenName):"true"),i.success&&i.success.apply(this,arguments)},u=function(e,t,n){var r;try{e.responseJSON=JSON.parse(e.responseText),r=[e,t,n]}catch(s){r=arguments}i.error&&i.error.apply(this,r)},a={contentType:i.contentType,dataType:i.dataType,success:o,error:u,data:e},f="";return i.baseURL?f=i.baseURL:this.baseURL&&(f=this.baseURL),r.register?f+=r.register:f+="auth/register",f.length&&(a.url=f),t.ajax(t.extend({},n,{type:"POST"},a))},login:function(e,i){i=i||{};var s=this,o=function(e,t,n){sessionStorage.setItem("ag-auth-"+s.name,s.agAuth?n.getResponseHeader(s.tokenName):"true"),i.success&&i.success.apply(this,arguments)},u=function(e,t,n){var r;try{e.responseJSON=JSON.parse(e.responseText),r=[e,t,n]}catch(s){r=arguments}i.error&&i.error.apply(this,r)},a={contentType:i.contentType,dataType:i.dataType,success:o,error:u,data:e},f="";return i.baseURL?f=i.baseURL:this.baseURL&&(f=this.baseURL),r.login?f+=r.login:f+="auth/login",f.length&&(a.url=f),t.ajax(t.extend({},n,{type:"POST"},a))},logout:function(e){e=e||{};var i=this,s=function(t,n,r){i.deauthorize(),e.success&&e.success.apply(this,arguments)},o=function(t,n,r){var i;try{t.responseJSON=JSON.parse(t.responseText),i=[t,n,r]}catch(s){i=arguments}e.error&&e.error.apply(this,i)},u={success:s,error:o},a="";return e.baseURL?a=e.baseURL:this.baseURL&&(a=this.baseURL),r.logout?a+=r.logout:a+="auth/logout",a.length&&(u.url=a),this.agAuth&&(u.headers={},u.headers[this.tokenName]=sessionStorage.getItem("ag-auth-"+this.name)),t.ajax(t.extend({},n,{type:"POST"},u))},isAuthenticated:function(){var e=sessionStorage.getItem("ag-auth-"+this.name);return!!e},addAuth:function(e){return e.headers={},e.headers[this.tokenName]=sessionStorage.getItem("ag-auth-"+this.name),t.extend({},e)},deauthorize:function(){sessionStorage.removeItem("ag-auth-"+this.name)}}}}(aerogear,jQuery);