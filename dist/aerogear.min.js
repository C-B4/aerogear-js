/*! AeroGear JavaScript Library - v1.0.0.Alpha - 2012-08-29
* https://github.com/aerogear/aerogear-js
* JBoss, Home of Professional Open Source
* Copyright 2012, Red Hat, Inc., and individual contributors
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
* http://www.apache.org/licenses/LICENSE-2.0
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/
(function(a,b){var c=a.aerogear={add:function(a){var b,d,e=this._getCollection();if(!a)return this;if(typeof a=="string")e[a]=c[this.lib].adapters[this.defaultAdapter](a,"id");else if(c.isArray(a))for(b=0;b<a.length;b++)d=a[b],typeof d=="string"?e[d]=c[this.lib].adapters[this.defaultAdapter](d):e[d.name]=c[this.lib].adapters[d.type||this.defaultAdapter](d.name,d.recordId||"id",d.settings||{});else e[a.name]=c[this.lib].adapters[a.type||this.defaultAdapter](a.name,a.recordId||"id",a.settings||{});return this._setCollection(e),this},remove:function(a){var b,d,e=this._getCollection();if(typeof a=="string")delete e[a];else if(c.isArray(a))for(b=0;b<a.length;b++)d=a[b],typeof d=="string"?delete e[d]:delete e[d.name];else a&&delete e[a.name];return this._setCollection(e),this}};c.isArray=function(a){return{}.toString.call(a)==="[object Array]"}})(this),function(a,b){a.pipeline=function(b){var c={lib:"pipeline",defaultAdapter:"rest",pipes:{},add:function(b){return a.add.call(this,b)},remove:function(b){return a.remove.call(this,b)},_setCollection:function(a){this.pipes=a},_getCollection:function(){return this.pipes}};return c.add(b)},a.pipeline.adapters={}}(aerogear),function(a,b,c){function d(a){return{}.toString.call(a)==="[object Array]"}a.pipeline.adapters.rest=function(a,c,e){return e=b.extend({url:a,contentType:"application/json",dataType:"json"},e),{recordId:c,type:"rest",data:null,read:function(a){var c=this,f;a?(a.ajax&&a.ajax.data?f=a.ajax.data:a.data?f=a.data:a.ajax||(a.ajax={}),f&&(a.ajax.data=f)):a={ajax:{}};var g=function(b){c.data=d(b)?b:[b],a.ajax.success&&a.ajax.success.apply(this,arguments)};return b.ajax(b.extend({},e,{type:"GET"},a.ajax,{success:g}))},save:function(a,c){var f=this,g,h,i=!1;a=a||{},c=c||{},g=a[this.recordId]?"PUT":"POST",!c.ajax.url&&a[this.recordId]?h=e.url+"/"+a[this.recordId]:c.ajax.url?h=c.ajax.url:h=e.url;var j=function(a){if(f.data){for(var b in f.data)f.data[b].id===a.id&&(f.data[b]=a,i=!0);i||f.data.push(a)}else f.data=d(a)?a:[a];c.ajax.success&&c.ajax.success.apply(this,arguments)};return typeof a!="string"&&(a=JSON.stringify(a)),b.ajax(b.extend({},e,{data:a,type:g,url:h},c.ajax||{},{success:j}))},remove:function(a,c){var d=this,f=0,g="",h;c=c||{};if(typeof a=="string"||typeof a=="number")f=parseInt(a,10);else if(a)typeof a.record=="string"||typeof a.record=="number"?f=parseInt(a.record,10):a.record&&(f=parseInt(a.record[this.recordId],10));else throw"aerogear.pipeline.rest: missing argument";g=f?"/"+f:"",c.ajax?c.ajax.url?h=c.ajax.url:h=e.url+g:a.ajax?(c.ajax=a.ajax,a.ajax.url?h=a.ajax.url:h=e.url+g):h=e.url+g;var i=function(a){var b;for(var e in d.data)d.data[e].id===f&&d.data.splice(e,1);c.ajax.success&&c.ajax.success.apply(this,arguments)};return b.ajax(b.extend({},e,{type:"DELETE",url:h},c.ajax||{},{success:i}))},filter:function(a,b){var c,d,e;return a?(c=this.data.filter(function(c,f,g){var h=b?!1:!0,k=Object.keys(a),l,m,n;for(d=0;d<k.length;d++){if(a[k[d]].data){l=a[k[d]],n=l.matchAny?!1:!0;for(e=0;e<l.data.length;e++){if(l.matchAny&&l.data[e]===c[k[d]]){n=!0;break}if(!l.matchAny&&l.data[e]!==c[k[d]]){n=!1;break}}}else n=a[k[d]]===c[k[d]]?!0:!1;if(b&&n){h=!0;break}if(!b&&!n){h=!1;break}}return h}),c):(c=this.data||[],c)}}}}(aerogear,jQuery);