/*! AeroGear JavaScript Library - v1.0.0.Alpha - 2012-09-21
* https://github.com/aerogear/aerogear-js
* JBoss, Home of Professional Open Source
* Copyright 2012, Red Hat, Inc., and individual contributors
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
* http://www.apache.org/licenses/LICENSE-2.0
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/
(function(e,t){var n=e.aerogear={add:function(e){var t,r,i=this._getCollection();if(!e)return this;if(typeof e=="string")i[e]=n[this.lib].adapters[this.defaultAdapter](e);else if(n.isArray(e))for(t=0;t<e.length;t++)r=e[t],typeof r=="string"?i[r]=n[this.lib].adapters[this.defaultAdapter](r):i[r.name]=n[this.lib].adapters[r.type||this.defaultAdapter](r.name,r.settings||{});else i[e.name]=n[this.lib].adapters[e.type||this.defaultAdapter](e.name,e.settings||{});return this._setCollection(i),this},remove:function(e){var t,r,i=this._getCollection();if(typeof e=="string")delete i[e];else if(n.isArray(e))for(t=0;t<e.length;t++)r=e[t],typeof r=="string"?delete i[r]:delete i[r.name];else e&&delete i[e.name];return this._setCollection(i),this}};n.isArray=function(e){return{}.toString.call(e)==="[object Array]"}})(this),function(e,t,n){e.ajax=function(n,r){var i=t.Deferred(function(){var i=this,s=t.extend({},{contentType:"application/json",dataType:"json"},r);this.done(s.success),this.fail(s.error),this.always(s.complete);var o=t.extend({},s,{success:function(e,t,n){i.resolve(typeof e=="string"&&o.dataType==="json"?JSON.parse(e):e,t,n)},error:function(e,t,n){i.reject(e,t,n)},complete:function(e,t){i.resolve(e,t)}});o.contentType==="application/json"&&o.data&&o.type==="POST"&&(o.data=JSON.stringify(o.data)),e.auth&&!n.isAuthenticated()?this.reject("auth","Error: Authentication Required"):n.addAuth?t.ajax(n.addAuth(o)):t.ajax(o)}),s=i.promise();return s.success=i.done,s.error=i.fail,s.complete=i.always,s}}(aerogear,jQuery),function(e,t){e.pipeline=function(t){var n={lib:"pipeline",defaultAdapter:"rest",pipes:{},add:function(t,n){return e.add.call(this,t)},remove:function(t){return e.remove.call(this,t)},_setCollection:function(e){this.pipes=e},_getCollection:function(){return this.pipes}};return n.add(t)},e.pipeline.adapters={}}(aerogear),function(e,t,n){e.pipeline.adapters.rest=function(n,r){var i=r&&r.endPoint?r.endPoint:n,s=t.extend({url:r&&r.baseURL?r.baseURL+"/"+i:i},r);return{recordId:r&&r.recordId?r.recordId:"id",authenticator:r&&r.authenticator?r.authenticator:null,type:"rest",read:function(n){n=n||{};var r=function(t){var r=n.valves?e.isArray(n.valves)?n.valves:[n.valves]:[],i;if(r.length)for(i in r)r[i].save(t,!0);n.success&&n.success.apply(this,arguments)},i={type:"GET",success:r};return n.error&&(i.error=n.error),e.ajax(this,t.extend({},s,i))},save:function(n,r){var i,o;n=n||{},r=r||{},i=n[this.recordId]?"PUT":"POST",!r.url&&n[this.recordId]?o=s.url+"/"+n[this.recordId]:r.url?o=r.url:o=s.url;var u=function(t){var n=e.isArray(r.valves)?r.valves:[r.valves],i;if(r.valves)for(i in n)n[i].save(t);r.success&&r.success.apply(this,arguments)},a={data:n,type:i,url:o,success:u};return r.error&&(a.error=r.error),e.ajax(this,t.extend({},s,a))},remove:function(n,r){var i="",o,u;r=r||{},typeof n=="string"||typeof n=="number"?o=n:n&&(typeof n.record=="string"||typeof n.record=="number"?o=n.record:n.record&&(o=n.record[this.recordId]),n.success&&!r.success&&(r.success=n.success),n.error&&!r.error&&(r.error=n.error)),i=o?"/"+o:"",r.url?u=r.url:n.url?u=n.url:u=s.url+i;var a=function(t){var n=e.isArray(r.valves)?r.valves:[r.valves],i;if(r.valves)for(i in n)n[i].remove(o);r.success&&r.success.apply(this,arguments)},f={type:"DELETE",url:u,success:a};return r.error&&(f.error=r.error),e.ajax(this,t.extend({},s,f))},isAuthenticated:function(){return this.authenticator?this.authenticator.isAuthenticated():!0},addAuth:function(e){return this.authenticator?this.authenticator.addAuth(e):e},deauthorize:function(){this.authenticator&&this.authenticator.deauthorize()}}}}(aerogear,jQuery),function(e,t){e.dataManager=function(t){var n={lib:"dataManager",defaultAdapter:"memory",valves:{},add:function(t){return e.add.call(this,t)},remove:function(t){return e.remove.call(this,t)},_setCollection:function(e){this.valves=e},_getCollection:function(){return this.valves}};return n.add(t)},e.dataManager.adapters={}}(aerogear),function(e,t,n){e.dataManager.adapters.memory=function(t,n){return{recordId:n&&n.recordId?n.recordId:"id",type:"memory",data:null,read:function(e){var t={};return t[this.recordId]=e,e?this.filter(t):this.data},save:function(t,n){var r=!1;t=e.isArray(t)?t:[t];if(n)this.data=t;else if(this.data)for(var i=0;i<t.length;i++){for(var s in this.data)if(this.data[s][this.recordId]===t[i][this.recordId]){this.data[s]=t[i],r=!0;break}r||this.data.push(t[i]),r=!1}else this.data=t;return this.data},remove:function(t){if(!t)return this.data=[];t=e.isArray(t)?t:[t];var n,r;for(var i=0;i<t.length;i++){if(typeof t[i]=="string"||typeof t[i]=="number")n=t[i];else{if(!t)continue;n=t[i][this.recordId]}for(r in this.data)this.data[r][this.recordId]===n&&this.data.splice(r,1)}return this.data},filter:function(e,t){var n,r,i;return e?(n=this.data.filter(function(n,s,o){var u=t?!1:!0,a=Object.keys(e),f,l,c;for(r=0;r<a.length;r++){if(e[a[r]].data){f=e[a[r]],c=f.matchAny?!1:!0;for(i=0;i<f.data.length;i++){if(f.matchAny&&f.data[i]===n[a[r]]){c=!0;break}if(!f.matchAny&&f.data[i]!==n[a[r]]){c=!1;break}}}else c=e[a[r]]===n[a[r]]?!0:!1;if(t&&c){u=!0;break}if(!t&&!c){u=!1;break}}return u}),n):(n=this.data||[],n)}}}}(aerogear,jQuery),function(e,t){e.auth=function(t){var n={lib:"auth",defaultAdapter:"rest",modules:{},add:function(t){return e.add.call(this,t)},remove:function(t){return e.remove.call(this,t)},_setCollection:function(e){this.modules=e},_getCollection:function(){return this.modules}};return n.add(t)},e.auth.adapters={}}(aerogear),function(e,t,n){e.auth.adapters.rest=function(e,n){var r=n&&n.endPoints||{};return n=n||{},{type:"rest",name:e,agAuth:!!n.agAuth,baseURL:n.baseURL||null,register:function(e,i){i=i||{};var s=this,o=function(e,t,n){sessionStorage.setItem("ag-auth-"+s.name,s.agAuth?e["Auth-Token"]:"true"),i.success&&i.success.apply(this,arguments)},u={success:o,data:e},a="";return i.error&&(u.error=i.error),i.baseURL?a=i.baseURL:this.baseURL&&(a=this.baseURL),r.register?a+=r.register:a+="auth/register",a.length&&(u.url=a),t.ajax(t.extend({},n,{type:"POST"},u))},login:function(e,i){i=i||{};var s=this,o=function(e,t,n){sessionStorage.setItem("ag-auth-"+s.name,s.agAuth?e.token:"true"),i.success&&i.success.apply(this,arguments)},u={success:o},a="";return i.error&&(u.error=i.error),i.baseURL?a=i.baseURL:this.baseURL&&(a=this.baseURL),r.login?a+=r.login:a+="auth/login",a.length&&(u.url=a),this.agAuth?u.headers={"Auth-Credential":e.credential,"Auth-Password":e.password}:u.data=e,t.ajax(t.extend({},n,{type:"POST"},u))},isAuthenticated:function(){var e=sessionStorage.getItem("ag-auth-"+this.name);return!!e},addAuth:function(e){return t.extend({},e,{headers:{"Auth-Token":sessionStorage.getItem("ag-auth-"+this.name)}})},deauthorize:function(){sessionStorage.removeItem("ag-auth-"+this.name)}}}}(aerogear,jQuery);