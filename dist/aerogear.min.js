/*! AeroGear JavaScript Library - v1.0.0.Alpha - 2012-10-05
* https://github.com/aerogear/aerogear-js
* JBoss, Home of Professional Open Source
* Copyright 2012, Red Hat, Inc., and individual contributors
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
* http://www.apache.org/licenses/LICENSE-2.0
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/
(function(e,t){var n=e.aerogear={add:function(e){var t,r,i=this[this.collectionName]||{};if(!e)return this;if(typeof e=="string")i[e]=n[this.lib].adapters[this.type](e);else if(n.isArray(e))for(t=0;t<e.length;t++)r=e[t],typeof r=="string"?i[r]=n[this.lib].adapters[this.type](r):i[r.name]=n[this.lib].adapters[r.type||this.type](r.name,r.settings||{});else i[e.name]=n[this.lib].adapters[e.type||this.type](e.name,e.settings||{});return this[this.collectionName]=i,this},remove:function(e){var t,r,i=this[this.collectionName]||{};if(typeof e=="string")delete i[e];else if(n.isArray(e))for(t=0;t<e.length;t++)r=e[t],typeof r=="string"?delete i[r]:delete i[r.name];else e&&delete i[e.name];return this[this.collectionName]=i,this}};n.isArray=function(e){return{}.toString.call(e)==="[object Array]"}})(this),function(e,t,n){e.ajax=function(n,r){var i=t.Deferred(function(){var i=this,s=t.extend({},{contentType:"application/json",dataType:"json"},r);this.done(s.success),this.fail(s.error),this.always(s.complete);var o=t.extend({},s,{success:function(e,t,n){i.resolve(typeof e=="string"&&o.dataType==="json"?JSON.parse(e):e,t,n)},error:function(e,t,n){if(o.dataType==="json")try{e.responseJSON=JSON.parse(e.responseText)}catch(r){}i.reject(e,t,n)},complete:function(e,t){i.resolve(e,t)}});o.contentType==="application/json"&&o.data&&(o.type==="POST"||o.type==="PUT")&&(o.data=JSON.stringify(o.data)),e.auth&&!n.isAuthenticated()?this.reject("auth","Error: Authentication Required"):n.addAuthIdentifier?t.ajax(n.addAuthIdentifier(o)):t.ajax(o)}),s=i.promise();return s.success=i.done,s.error=i.fail,s.complete=i.always,s}}(aerogear,jQuery),function(e,t,n){e.pipeline=function(n){var r=t.extend({},e,{lib:"pipeline",type:n?n.type||"rest":"rest",collectionName:"pipes"});return r.add(n)},e.pipeline.adapters={}}(aerogear,jQuery),function(e,t,n){e.pipeline.adapters.rest=function(t,n){if(!(this instanceof e.pipeline.adapters.rest))return new e.pipeline.adapters.rest(t,n);n=n||{};var r=n.endpoint||t,i={url:n.baseURL?n.baseURL+r:r},s=n.recordId||"id",o=n.authenticator||null,u="rest";this.isAuthenticated=function(){return o?o.isAuthenticated():!0},this.addAuthIdentifier=function(e){return o?o.addAuthIdentifier(e):e},this.deauthorize=function(){o&&o.deauthorize()},this.getAjaxSettings=function(){return i},this.getRecordId=function(){return s},this.getAuthenticator=function(){return o}},e.pipeline.adapters.rest.prototype.read=function(n){n=n||{};var r=this,i=function(t){var r=n.stores?e.isArray(n.stores)?n.stores:[n.stores]:[],i;if(r.length)for(i in r)r[i].save(t,!0);n.success&&n.success.apply(this,arguments)},s=function(t,r){var i=n.stores?e.isArray(n.stores)?n.stores:[n.stores]:[],s;if(t==="auth"&&i.length)for(s in i)i[s].remove();n.error&&n.error.apply(this,arguments)},o={type:"GET",success:i,error:s,statusCode:n.statusCode,complete:n.complete};return e.ajax(this,t.extend({},this.getAjaxSettings(),o))},e.pipeline.adapters.rest.prototype.save=function(n,r){var i=this,s=this.getRecordId(),o=this.getAjaxSettings(),u,a;n=n||{},r=r||{},u=n[s]?"PUT":"POST",n[s]?a=o.url+"/"+n[s]:a=o.url;var f=function(t){var n=e.isArray(r.stores)?r.stores:[r.stores],i;if(r.stores)for(i in n)n[i].save(t);r.success&&r.success.apply(this,arguments)},l=function(t,n){var i=r.stores?e.isArray(r.stores)?r.stores:[r.stores]:[],s;if(t==="auth"&&i.length)for(s in i)i[s].remove();r.error&&r.error.apply(this,arguments)},c={data:n,type:u,url:a,success:f,error:l,statusCode:r.statusCode,complete:r.complete};return e.ajax(this,t.extend({},o,c))},e.pipeline.adapters.rest.prototype.remove=function(n,r){var i=this,s=this.getRecordId(),o=this.getAjaxSettings(),u="",a,f;typeof n=="string"||typeof n=="number"?a=n:n&&n[s]?a=n[s]:n&&!r&&(r=n),r=r||{},u=a?"/"+a:"",f=o.url+u;var l=function(t){var n,i;if(r.stores){n=e.isArray(r.stores)?r.stores:[r.stores];for(i in n)n[i].remove(a)}r.success&&r.success.apply(this,arguments)},c=function(t,n){var i=r.stores?e.isArray(r.stores)?r.stores:[r.stores]:[],s;if(t==="auth"&&i.length)for(s in i)i[s].remove();r.error&&r.error.apply(this,arguments)},h={type:"DELETE",url:f,success:l,error:c,statusCode:r.statusCode,complete:r.complete};return e.ajax(this,t.extend({},o,h))}}(aerogear,jQuery),function(e,t,n){e.dataManager=function(n){var r=t.extend({},e,{lib:"dataManager",type:n?n.type||"memory":"memory",collectionName:"stores"});return r.add(n)},e.dataManager.adapters={}}(aerogear,jQuery),function(e,t,n){e.dataManager.adapters.memory=function(t,n){if(!(this instanceof e.dataManager.adapters.memory))return new e.dataManager.adapters.memory(t,n);n=n||{};var r=n.recordId?n.recordId:"id",i="memory",s=null;this.getRecordId=function(){return r},this.getData=function(){return s},this.setData=function(e){s=e},this.addDataRecord=function(e){s.push(e)},this.removeDataRecord=function(e){s.splice(e,1)}},e.dataManager.adapters.memory.prototype.read=function(e){var t={};return t[this.getRecordId()]=e,e?this.filter(t):this.getData()},e.dataManager.adapters.memory.prototype.save=function(t,n){var r=!1;t=e.isArray(t)?t:[t];if(n)this.setData(t);else if(this.getData())for(var i=0;i<t.length;i++){for(var s in this.getData())if(this.getData()[s][this.getRecordId()]===t[i][this.getRecordId()]){this.getData()[s]=t[i],r=!0;break}r||this.addDataRecord(t[i]),r=!1}else this.setData(t);return this.getData()},e.dataManager.adapters.memory.prototype.remove=function(t){if(!t)return this.setData([]),this.getData();t=e.isArray(t)?t:[t];var n,r;for(var i=0;i<t.length;i++){if(typeof t[i]=="string"||typeof t[i]=="number")n=t[i];else{if(!t)continue;n=t[i][this.getRecordId()]}for(r in this.getData())this.getData()[r][this.getRecordId()]===n&&this.removeDataRecord(r)}return this.getData()},e.dataManager.adapters.memory.prototype.filter=function(n,r){var i,s,o,u;return n?(i=this.getData().filter(function(i,a,f){var l=r?!1:!0,c=Object.keys(n),h,p,d;for(s=0;s<c.length;s++){if(n[c[s]].data){h=n[c[s]],d=h.matchAny?!1:!0;for(o=0;o<h.data.length;o++)if(e.isArray(i[c[s]]))if(i[c[s]].length){if(t(i[c]).not(h.data).length===0&&t(h.data).not(i[c]).length===0){d=!0;break}for(u=0;u<i[c[s]].length;u++){if(h.matchAny&&h.data[o]===i[c[s]][u]){d=!0;break}if(!h.matchAny&&h.data[o]!==i[c[s]][u]){d=!1;break}}}else d=!1;else{if(h.matchAny&&h.data[o]===i[c[s]]){d=!0;break}if(!h.matchAny&&h.data[o]!==i[c[s]]){d=!1;break}}}else if(e.isArray(i[c[s]])){d=r?!1:!0;if(i[c[s]].length)for(o=0;o<i[c[s]].length;o++){if(r&&n[c[s]]===i[c[s]][o]){d=!0;break}if(!r&&n[c[s]]!==i[c[s]][o]){d=!1;break}}else d=!1}else d=n[c[s]]===i[c[s]]?!0:!1;if(r&&d){l=!0;break}if(!r&&!d){l=!1;break}}return l}),i):(i=this.getData()||[],i)}}(aerogear,jQuery),function(e,t,n){e.auth=function(n){var r=t.extend({},e,{lib:"auth",type:n.type||"rest",collectionName:"modules"});return r.add(n)},e.auth.adapters={}}(aerogear,jQuery),function(e,t,n){e.auth.adapters.rest=function(n,r){if(!(this instanceof e.auth.adapters.rest))return new e.auth.adapters.rest(n,r);r=r||{};var i=r.endpoints||{},s="rest",o=n,u=!!r.agAuth,a=r.baseURL,f=r.tokenName||"Auth-Token";this.isAuthenticated=function(){return u?!!sessionStorage.getItem("ag-auth-"+o):!0},this.addAuthIdentifier=function(e){return e.headers={},e.headers[f]=sessionStorage.getItem("ag-auth-"+o),t.extend({},e)},this.deauthorize=function(){sessionStorage.removeItem("ag-auth-"+o)},this.getSettings=function(){return r},this.getEndpoints=function(){return i},this.getName=function(){return o},this.getAGAuth=function(){return u},this.getBaseURL=function(){return a},this.getTokenName=function(){return f}},e.auth.adapters.rest.prototype.enroll=function(e,n){n=n||{};var r=this,i=this.getName(),s=this.getTokenName(),o=this.getBaseURL(),u=this.getEndpoints(),a=this.getAGAuth(),f=function(e,t,o){sessionStorage.setItem("ag-auth-"+i,r.getAGAuth()?o.getResponseHeader(s):"true"),n.success&&n.success.apply(this,arguments)},l=function(e,t,r){var i;try{e.responseJSON=JSON.parse(e.responseText),i=[e,t,r]}catch(s){i=arguments}n.error&&n.error.apply(this,i)},c={success:f,error:l,data:e},h="";return n.contentType?c.contentType=n.contentType:a&&(c.contentType="application/json"),n.dataType?c.dataType=n.dataType:a&&(c.dataType="json"),n.baseURL?h=n.baseURL:o&&(h=o),u.enroll?h+=u.enroll:h+="auth/register",h.length&&(c.url=h),t.ajax(t.extend({},this.getSettings(),{type:"POST"},c))},e.auth.adapters.rest.prototype.login=function(e,n){n=n||{};var r=this,i=this.getName(),s=this.getTokenName(),o=this.getBaseURL(),u=this.getEndpoints(),a=this.getAGAuth(),f=function(e,t,o){sessionStorage.setItem("ag-auth-"+i,r.getAGAuth()?o.getResponseHeader(s):"true"),n.success&&n.success.apply(this,arguments)},l=function(e,t,r){var i;try{e.responseJSON=JSON.parse(e.responseText),i=[e,t,r]}catch(s){i=arguments}n.error&&n.error.apply(this,i)},c={success:f,error:l,data:e},h="";return n.contentType?c.contentType=n.contentType:a&&(c.contentType="application/json"),n.dataType?c.dataType=n.dataType:a&&(c.dataType="json"),n.baseURL?h=n.baseURL:o&&(h=o),u.login?h+=u.login:h+="auth/login",h.length&&(c.url=h),t.ajax(t.extend({},this.getSettings(),{type:"POST"},c))},e.auth.adapters.rest.prototype.logout=function(e){e=e||{};var n=this,r=this.getName(),i=this.getTokenName(),s=this.getBaseURL(),o=this.getEndpoints(),u=function(t,r,i){n.deauthorize(),e.success&&e.success.apply(this,arguments)},a=function(t,n,r){var i;try{t.responseJSON=JSON.parse(t.responseText),i=[t,n,r]}catch(s){i=arguments}e.error&&e.error.apply(this,i)},f={success:u,error:a},l="";return e.baseURL?l=e.baseURL:s&&(l=s),o.logout?l+=o.logout:l+="auth/logout",l.length&&(f.url=l),this.isAuthenticated()&&(f.headers={},f.headers[i]=sessionStorage.getItem("ag-auth-"+r)),t.ajax(t.extend({},this.getSettings(),{type:"POST"},f))}}(aerogear,jQuery);