/*! AeroGear JavaScript Library - v1.0.0.Alpha - 2012-08-31
* https://github.com/aerogear/aerogear-js
* JBoss, Home of Professional Open Source
* Copyright 2012, Red Hat, Inc., and individual contributors
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
* http://www.apache.org/licenses/LICENSE-2.0
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/
(function(a,b){var c=a.aerogear={add:function(a){var b,d,e=this._getCollection();if(!a)return this;if(typeof a=="string")e[a]=c[this.lib].adapters[this.defaultAdapter](a,"id");else if(c.isArray(a))for(b=0;b<a.length;b++)d=a[b],typeof d=="string"?e[d]=c[this.lib].adapters[this.defaultAdapter](d):e[d.name]=c[this.lib].adapters[d.type||this.defaultAdapter](d.name,d.recordId||"id",d.settings||{});else e[a.name]=c[this.lib].adapters[a.type||this.defaultAdapter](a.name,a.recordId||"id",a.settings||{});return this._setCollection(e),this},remove:function(a){var b,d,e=this._getCollection();if(typeof a=="string")delete e[a];else if(c.isArray(a))for(b=0;b<a.length;b++)d=a[b],typeof d=="string"?delete e[d]:delete e[d.name];else a&&delete e[a.name];return this._setCollection(e),this}};c.isArray=function(a){return{}.toString.call(a)==="[object Array]"}})(this),function(a,b){a.pipeline=function(b,c){function d(b,c){b&&c&&(c.settings?c.settings.baseURL=b:c.settings={baseURL:b});var d,e;if(!c||!b)return c;if(typeof c=="string")c={name:c,settings:{baseURL:b}};else if(a.isArray(c))for(e=0;e<c.length;e++)d=c[e],typeof d=="string"?c[e]={name:c[e],settings:{baseURL:b}}:c[e].settings?c[e].settings.baseURL=b:c[e].settings={baseURL:b};else c.settings?c.settings.baseURL=b:c.settings={baseURL:b};return c}var e={lib:"pipeline",defaultAdapter:"rest",pipes:{},add:function(b,c){return a.add.call(this,d(c,b))},remove:function(b){return a.remove.call(this,b)},_setCollection:function(a){this.pipes=a},_getCollection:function(){return this.pipes}};return e.add(b,c)},a.pipeline.adapters={}}(aerogear),function(a,b,c){a.pipeline.adapters.rest=function(c,d,e){var f=b.extend({url:e&&e.baseURL?e.baseURL+c:c,contentType:"application/json",dataType:"json"},e);return{recordId:d,type:"rest",read:function(c){var d;c?(c.ajax&&c.ajax.data?d=c.ajax.data:c.data?d=c.data:c.ajax||(c.ajax={}),d&&(c.ajax.data=d)):c={ajax:{}};var e=function(b){var d=c.valves?a.isArray(c.valves)?c.valves:[c.valves]:[],e;if(d.length)for(e in d)d[e].save(b,!0);c.ajax.success&&c.ajax.success.apply(this,arguments)};return b.ajax(b.extend({},f,{type:"GET"},c.ajax,{success:e}))},save:function(c,d){var e,g;c=c||{},d=d||{},e=c[this.recordId]?"PUT":"POST",!d.ajax.url&&c[this.recordId]?g=f.url+"/"+c[this.recordId]:d.ajax.url?g=d.ajax.url:g=f.url;var h=function(b){var c=a.isArray(d.valves)?d.valves:[d.valves],e;if(d.valves)for(e in c)c[e].save(b);d.ajax.success&&d.ajax.success.apply(this,arguments)};return typeof c!="string"&&(c=JSON.stringify(c)),b.ajax(b.extend({},f,{data:c,type:e,url:g},d.ajax||{},{success:h}))},remove:function(c,d){var e="",g,h;d=d||{};if(typeof c=="string"||typeof c=="number")g=parseInt(c,10);else if(c)typeof c.record=="string"||typeof c.record=="number"?g=parseInt(c.record,10):c.record&&(g=parseInt(c.record[this.recordId],10));else throw"aerogear.pipeline.rest: missing argument";e=g?"/"+g:"",d.ajax?d.ajax.url?h=d.ajax.url:h=f.url+e:c.ajax?(d.ajax=c.ajax,c.ajax.url?h=c.ajax.url:h=f.url+e):h=f.url+e;var i=function(b){var c=a.isArray(d.valves)?d.valves:[d.valves],e;if(d.valves)for(e in c)c[e].remove(g);d.ajax.success&&d.ajax.success.apply(this,arguments)};return b.ajax(b.extend({},f,{type:"DELETE",url:h},d.ajax||{},{success:i}))}}}}(aerogear,jQuery),function(a,b){a.dataManager=function(b){var c={lib:"dataManager",defaultAdapter:"memory",valves:{},add:function(b){return a.add.call(this,b)},remove:function(b){return a.remove.call(this,b)},_setCollection:function(a){this.valves=a},_getCollection:function(){return this.valves}};return c.add(b)},a.dataManager.adapters={}}(aerogear),function(a,b,c){a.dataManager.adapters.memory=function(b,c,d){return{recordId:c,type:"memory",data:null,read:function(a){var b={};return b[c]=a,a?this.filter(b):this.data},save:function(b,c){var d=!1;c&&(this.data=null);if(this.data){for(var e in this.data)if(this.data[e].id===b.id){this.data[e]=b,d=!0;break}d||this.data.push(b)}else this.data=a.isArray(b)?b:[b];return this.data},remove:function(a){if(!a)return this.data=[];var b,c;if(typeof a=="string"||typeof a=="number")b=a;else if(a)b=a[this.recordId];else return this.data;for(c in this.data)this.data[c].id===b&&this.data.splice(c,1);return this.data},filter:function(a,b){var c,d,e;return a?(c=this.data.filter(function(c,f,g){var h=b?!1:!0,k=Object.keys(a),l,m,n;for(d=0;d<k.length;d++){if(a[k[d]].data){l=a[k[d]],n=l.matchAny?!1:!0;for(e=0;e<l.data.length;e++){if(l.matchAny&&l.data[e]===c[k[d]]){n=!0;break}if(!l.matchAny&&l.data[e]!==c[k[d]]){n=!1;break}}}else n=a[k[d]]===c[k[d]]?!0:!1;if(b&&n){h=!0;break}if(!b&&!n){h=!1;break}}return h}),c):(c=this.data||[],c)}}}}(aerogear,jQuery);